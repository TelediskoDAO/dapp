{"version":3,"file":"service-worker.js","sources":["../service-worker/config.js","../service-worker/index.js"],"sourcesContent":["const CONFIG = __buildEnv__;\nexport default CONFIG;\n","import CONFIG from \"./config\";\nconsole.log(\n  \"[Service Worker] Version:\",\n  CONFIG.version,\n  \"Build date:\",\n  new Date(CONFIG.date)\n);\n\nconst cacheName = CONFIG.version + \".\" + CONFIG.date;\nconst contentToCache = [\n  \"fonts/material-icons.woff2\",\n  \"images/icons/ios-share.png\",\n  \"images/logo-152.png\",\n  \"images/logo-167.png\",\n  \"images/logo-180.png\",\n  \"images/logo-192.png\",\n  \"images/logo-512.png\",\n  \"images/shortcut-time-tracking-192.png\",\n  \"images/splash-1125.png\",\n  \"images/splash-1242.png\",\n  \"images/splash-1536.png\",\n  \"images/splash-1668.png\",\n  \"images/splash-2048.png\",\n  \"images/splash-640.png\",\n  \"images/splash-750.png\",\n  \"core.js\",\n  \"bundle.js\",\n  \"components.css\",\n  \"./\",\n  \"manifest.webmanifest\",\n  \"style.css\",\n];\n\nfunction addToCache() {\n  console.log(`[Service Worker ${cacheName}] Caching app`);\n  return caches.open(cacheName).then((cache) =>\n    Promise.all(\n      contentToCache.map((url) =>\n        fetch(`${url}?${CONFIG.date}`).then((response) => {\n          console.log(`[Service Worker] Fetching ${url}?${CONFIG.date}`);\n          if (!response.ok) {\n            console.error(`[Service Worker ${cacheName}] Cannot fetch`, url);\n            throw Error(`Cannot fetch ${url}`);\n          }\n          return cache.put(url, response);\n        })\n      )\n    )\n  );\n}\n\nasync function retrieve({ request }) {\n  let response = await caches.match(request);\n  if (!response) {\n    console.log(`[Service Worker ${cacheName}] Fetch miss`, request.url);\n    response = await fetch(request);\n    // Don't cache responses for now.\n    // const cache = await caches.open(cacheName);\n    // console.log(\"[Service Worker] Caching new resource: \" + request.url);\n    // cache.put(request, response.clone());\n  } else {\n    console.log(`[Service Worker ${cacheName}] Fetch hit`, request.url);\n  }\n  return response;\n}\n\nasync function clearCaches() {\n  console.log(`[Service Worker ${cacheName}] Clear cache`);\n  const keys = (await caches.keys()).filter((key) => key !== cacheName);\n  return Promise.all(keys.map((key) => caches.delete(key)));\n}\n\nfunction register() {\n  console.log(`[Service Worker ${cacheName}] Register Listener: install`);\n  self.addEventListener(\"install\", (e) => {\n    e.waitUntil(addToCache());\n  });\n\n  console.log(`[Service Worker ${cacheName}] Register Listener: fetch`);\n  self.addEventListener(\"fetch\", (e) => {\n    e.respondWith(retrieve(e));\n  });\n\n  console.log(`[Service Worker ${cacheName}] Register Listener: activate`);\n  self.addEventListener(\"activate\", (e) => {\n    console.log(`[Service Worker ${cacheName}] Activate`);\n    e.waitUntil(clearCaches());\n  });\n\n  self.addEventListener(\"message\", function (event) {\n    console.log(\"[Service Worker] Message:\", event);\n    const port = event.ports[0];\n    switch (event.data.method) {\n      case \"skipWaiting\":\n        self.skipWaiting();\n        break;\n      case \"getInfo\":\n        port.postMessage({\n          result: {\n            version: CONFIG.version,\n            date: CONFIG.date,\n          },\n        });\n        break;\n      default:\n        break;\n    }\n  });\n}\n\nregister();\n"],"names":[],"mappings":"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"}